<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üß≠ Ascendente Crypto</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 20px; }
    h1 { color: #333; }
    input, button, select {
      margin: 5px;
      padding: 8px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
      background: #fff;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #333;
      color: white;
      cursor: pointer;
    }
    .highlight { font-weight: bold; background-color: #ffffcc; }
    .green { background-color: #c8e6c9; }
    .yellow { background-color: #fff9c4; }
    .orange { background-color: #ffe0b2; }
  </style>
</head>
<body>

  <h1>üß≠ Ascendente Crypto</h1>

  <div>
    <label>üîé Buscar por s√≠mbolo:</label>
    <input type="text" id="buscaSimbolo" placeholder="Ex: BTC">
    
    <label>Ranking m√≠nimo:</label>
    <input type="number" id="minRanking" min="1" placeholder="Ex: 1">
    
    <label>Ranking m√°ximo:</label>
    <input type="number" id="maxRanking" placeholder="Ex: 100">
    
    <button onclick="filtrarTabela()">Filtrar</button>
    <button onclick="limparFiltros()">Limpar</button>
  </div>

  <div>
    <button onclick="exportarPDF()">Exportar PDF</button>
  </div>

  <div>
    <h2>üî• Top 5 por Cor (Verde, Amarelo, Laranja)</h2>
    <ul id="topCores"></ul>

    <h2>üöÄ Avan√ßo Cont√≠nuo por Atualiza√ß√µes</h2>
    <ul id="topAvanco"></ul>
  </div>

  <table id="tabelaCriptos">
    <thead>
      <tr>
        <th onclick="ordenarPorColuna(0)">ID</th>
        <th onclick="ordenarPorColuna(1)">S√≠mbolo</th>
        <th onclick="ordenarPorColuna(2)">Pre√ßo</th>
        <th onclick="ordenarPorColuna(3)">Link</th>
        <th onclick="ordenarPorColuna(4)">Ranking Anterior</th>
        <th onclick="ordenarPorColuna(5)">Diferen√ßa</th>
        <th onclick="ordenarPorColuna(6)">Ranking Atual</th>
        <th onclick="ordenarPorColuna(7)">Status</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    let dadosOriginais = [];
    let ordemAscendente = true;

    async function carregarDados() {
      const resposta = await fetch('https://script.google.com/macros/s/AKfycbwuJPGDNy0bpnLo3x78SXyQqsL49Wy6O2keJwl0v2Z6Tb1Bf8zzIn5_Hep-8mYQqfVF/exec');
      const dados = await resposta.json();
      dadosOriginais = dados;
      preencherTabela(dados);
      preencherTops(dados);
    }

    function preencherTabela(dados) {
      const corpo = document.querySelector('#tabelaCriptos tbody');
      corpo.innerHTML = '';
      dados.forEach(linha => {
        const tr = document.createElement('tr');
        linha.forEach((valor, i) => {
          const td = document.createElement('td');
          td.textContent = valor;
          if (i === 5 && valor > 0) {
            if (valor >= 10) td.className = 'green';
            else if (valor >= 5) td.className = 'yellow';
            else td.className = 'orange';
          }
          if (i === 3) {
            const a = document.createElement('a');
            a.href = valor;
            a.target = "_blank";
            a.textContent = 'üîó';
            td.textContent = '';
            td.appendChild(a);
          }
          tr.appendChild(td);
        });
        corpo.appendChild(tr);
      });
    }

    function filtrarTabela() {
      const simbolo = document.getElementById('buscaSimbolo').value.toUpperCase();
      const minRank = parseInt(document.getElementById('minRanking').value);
      const maxRank = parseInt(document.getElementById('maxRanking').value);

      const filtrado = dadosOriginais.filter(row => {
        const simboloOK = !simbolo || row[1].toUpperCase().includes(simbolo);
        const rankAtual = parseInt(row[6]);
        const rankOK = (!minRank || rankAtual >= minRank) && (!maxRank || rankAtual <= maxRank);
        return simboloOK && rankOK;
      });

      preencherTabela(filtrado);
    }

    function limparFiltros() {
      document.getElementById('buscaSimbolo').value = '';
      document.getElementById('minRanking').value = '';
      document.getElementById('maxRanking').value = '';
      preencherTabela(dadosOriginais);
    }

    function ordenarPorColuna(indice) {
      ordemAscendente = !ordemAscendente;
      const ordenado = [...dadosOriginais].sort((a, b) => {
        if (typeof a[indice] === 'number') {
          return ordemAscendente ? a[indice] - b[indice] : b[indice] - a[indice];
        }
        return ordemAscendente
          ? String(a[indice]).localeCompare(String(b[indice]))
          : String(b[indice]).localeCompare(String(a[indice]));
      });
      preencherTabela(ordenado);
    }

    function preencherTops(dados) {
      const ulCores = document.getElementById('topCores');
      const ulAvanco = document.getElementById('topAvanco');

      const verdes = dados.filter(l => l[5] >= 10).slice(0, 5);
      const amarelos = dados.filter(l => l[5] >= 5 && l[5] < 10).slice(0, 5);
      const laranjas = dados.filter(l => l[5] > 0 && l[5] < 5).slice(0, 5);

      ulCores.innerHTML = [...verdes, ...amarelos, ...laranjas].map(l => `<li>${l[1]} (${l[5]} pontos)</li>`).join('');

      const avan√ßos = dados.filter(l => l[7] && l[7].toLowerCase().includes("subindo"))
                           .sort((a, b) => b[5] - a[5])
                           .slice(0, 5);
      ulAvanco.innerHTML = avan√ßos.map(l => `<li>${l[1]} (‚è´ ${l[5]} pontos)</li>`).join('');
    }

    function exportarPDF() {
      window.print();
    }

    carregarDados();
  </script>
</body>
</html>
