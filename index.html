<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üß≠ Ascendente Crypto</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 20px; }
    h1 { color: #333; }
    input, button, select { margin: 5px; padding: 8px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; background: #fff; }
    th, td { border: 1px solid #ddd; padding: 8px; text-align: center; }
    th { background-color: #333; color: white; cursor: pointer; }
    .green { background-color: #c8e6c9; }
    .yellow { background-color: #fff9c4; }
    .orange { background-color: #ffe0b2; }
  </style>
</head>
<body>

  <h1>üß≠ Ascendente Crypto</h1>

  <div>
    <label>üîç S√≠mbolo:</label>
    <input type="text" id="buscaSimbolo" oninput="filtrarTabela()" placeholder="Ex: BTC">
    <label>Ranking min:</label>
    <input type="number" id="minRanking" oninput="filtrarTabela()" placeholder="1">
    <label>Ranking max:</label>
    <input type="number" id="maxRanking" oninput="filtrarTabela()" placeholder="100">
    <button onclick="resetFiltros()">Limpar filtros</button>
    <button onclick="exportPDF()">Exportar PDF</button>
  </div>

  <table id="tabelaCriptos">
    <thead>
      <tr>
        <th onclick="ordenar(0)">ID</th>
        <th onclick="ordenar(1)">S√≠mbolo</th>
        <th onclick="ordenar(2)">Pre√ßo</th>
        <th>Link</th>
        <th onclick="ordenar(4)">Ranking Anterior</th>
        <th onclick="ordenar(5)">Diferen√ßa</th>
        <th onclick="ordenar(6)">Ranking Atual</th>
        <th onclick="ordenar(7)">Status</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    const URL = 'https://script.google.com/macros/s/AKfycbwuJPGDNy0bpnLo3x78SXyQqsL49Wy6O2keJwl0v2Z6Tb1Bf8zzIn5_Hep-8mYQqfVF/exec';
    let dados = [];
    let asc = true;

    async function carregar() {
      const resp = await fetch(URL);
      dados = await resp.json();
      preencherTabela(dados);
    }

    function preencherTabela(arr) {
      const tbody = document.querySelector('#tabelaCriptos tbody');
      tbody.innerHTML = '';
      arr.forEach(l => {
        if (l.diferenca <= 0) return;
        const tr = document.createElement('tr');
        tr.innerHTML = `
          <td>${l.id}</td>
          <td>${l.simbolo}</td>
          <td>$${parseFloat(l.preco).toFixed(4)}</td>
          <td><a href="${l.link}" target="_blank">üîó</a></td>
          <td>${l.rankingAnterior ?? '-'}</td>
          <td class="${l.diferenca>=10?'green':l.diferenca>=5?'yellow':'orange'}">${l.diferenca}</td>
          <td>${l.rankingAtual}</td>
          <td>${l.status}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    function filtrarTabela() {
      const sim = document.getElementById('buscaSimbolo').value.toUpperCase();
      const min = parseInt(document.getElementById('minRanking').value) || -Infinity;
      const max = parseInt(document.getElementById('maxRanking').value) || Infinity;
      const filtrado = dados.filter(l => l.diferenca > 0
        && l.simbolo.includes(sim)
        && l.rankingAtual >= min && l.rankingAtual <= max);
      preencherTabela(filtrado);
    }

    function resetFiltros() {
      document.getElementById('buscaSimbolo').value = '';
      document.getElementById('minRanking').value = '';
      document.getElementById('maxRanking').value = '';
      preencherTabela(dados);
    }

    function ordenar(col) {
      asc = !asc;
      dados.sort((a,b) => {
        const va = typeof a[col] === 'number' ? a[col] : String(a[col]);
        const vb = typeof b[col] === 'number' ? b[col] : String(b[col]);
        return asc ? (va > vb ? 1 : va < vb ? -1 : 0) : (vb > va ? 1 : vb < va ? -1 : 0);
      });
      preencherTabela(dados);
    }

    function exportPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      doc.text('üß≠ Ascendente Crypto ‚Äì Top Subidas', 10, 10);
      const table = document.querySelectorAll('#tabelaCriptos tbody tr');
      const body = Array.from(table).map(row => Array.from(row.children).map(td => td.innerText));
      doc.autoTable({
        head: [['ID','S√≠mbolo','Pre√ßo','Ranking Ant','Diferen√ßa','Ranking Atual','Status']],
        body, startY: 20, styles: { fontSize: 8 }
      });
      doc.save('top_subidas.pdf');
    }

    carregar();
  </script>
</body>
</html>
